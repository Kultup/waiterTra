# Roadmap — HR Training System

> Поточна версія: монолітний Express + React, один адмін, два навчальні модулі.

---

## Поточний стан (реалізовано)

| Модуль | Статус |
|--------|--------|
| Віртуальний стіл (накриття) | ✅ |
| Гра (Choice) — інтерактивні сценарії | ✅ |
| Результати тестів та ігор | ✅ |
| JWT-автентифікація адміна | ✅ |
| Серверне оцінювання | ✅ |
| Валідація вхідних даних | ✅ |
| LAN-доступ для студентів | ✅ |

---

## Фаза 1 — Базова інфраструктура

### 1.1 Групи та потоки студентів

**Проблема:** зараз неможливо розрізнити, хто з якої групи, результати змішані.

- Модель `Group` (`name`, `description`, `createdAt`)
- Поле `groupId` у `TestResult` та `GameResult`
- Студент при реєстрації на тест обирає групу зі списку
- Фільтрація результатів по групі в адмін-панелі
- Нова сторінка **Групи** у Sidebar

**Файли:**
- `server/models/Group.js`
- `server/routes/groups.js`
- `client/src/components/Groups.js`

---

### 1.2 Статистика та аналітика (Dashboard)

**Проблема:** Dashboard показує лише лічильники.

- Графік результатів по днях (бібліотека `recharts`)
- Топ-5 слабких місць (які предмети ставлять найчастіше неправильно)
- Середній % по шаблону / сценарію
- Порівняння груп між собою
- Виджет "Останні результати" з live-оновленням

**Нові API:**
- `GET /api/stats/overview` — зведена статистика
- `GET /api/stats/by-template/:id` — статистика по шаблону
- `GET /api/stats/by-group/:id` — статистика по групі

---

### 1.3 Експорт результатів

- Кнопка **Завантажити CSV** на сторінці результатів
- Кнопка **Завантажити PDF** — звіт по групі/шаблону
- Бібліотека: `xlsx` (для Excel) або `papaparse` (для CSV)
- PDF через `@react-pdf/renderer` або `pdfmake` на сервері

**Новий маршрут:**
- `GET /api/test-results/export?format=csv&groupId=...`

---

## Фаза 2 — Нові типи тестів

### 2.1 Тест з вибором відповіді (Quiz)

Новий модуль — класичний тест із варіантами.

**Структура питання:**
```json
{
  "text": "Яка температура подачі білого вина?",
  "options": ["8-10°C", "12-14°C", "16-18°C", "20-22°C"],
  "correctIndex": 0,
  "image": "optional-url"
}
```

- Модель `Quiz` (`title`, `questions[]`, `timeLimit`, `passingScore`)
- Модель `QuizResult`
- Сторінка **Quiz Builder** в адмін-панелі (аналог VirtualDesk)
- Публічна сторінка `/quiz/:hash` для студентів
- Оцінювання на сервері

**Нові файли:**
- `server/models/Quiz.js`, `QuizResult.js`
- `server/routes/quiz.js`
- `client/src/components/QuizBuilder.js`
- `client/src/components/QuizPlay.js`

---

### 2.2 Тест на послідовність (Drag & Drop)

Студент перетягує картки у правильному порядку (наприклад, порядок подачі страв).

- Модель `SequenceTest` (`title`, `steps[]`, `timeLimit`)
- Кожен `step`: `{ text, correctPosition, image? }`
- Оцінювання: скільки елементів на правильному місці
- Бібліотека: `@dnd-kit/core`

---

### 2.3 Тест із зображенням (Hotspot)

Студент кліком позначає правильну зону на фото (наприклад, знайти помилку в сервіруванні).

- Зображення завантажується адміном
- Адмін малює "правильні зони" прямокутниками
- Студент клікає — система перевіряє влучення в зону

---

## Фаза 3 — Управління персоналом

### 3.1 Відновлення модуля Employee

Повернути та розширити legacy-модуль.

**Модель `Employee` (розширена):**
```
firstName, lastName, email, position, department,
phone, hireDate, groupId, avatar, notes
```

- Список співробітників із фільтрами (відділ, посада)
- Картка співробітника з особистою статистикою
- Прив'язка результатів до профілю (по email або вручну)
- Сторінка **Співробітники** у Sidebar

---

### 3.2 Навчальні плани (Training Paths)

- Модель `TrainingPath` (`title`, `steps[]`) — послідовність тестів/ігор
- Призначення плану групі або окремому співробітнику
- Прогрес-бар виконання плану
- Автоматичне відправлення наступного посилання після проходження поточного кроку

---

### 3.3 Сертифікати

- Після проходження навчального плану або окремого тесту (якщо ≥ X%) — генерується PDF-сертифікат
- Містить: ім'я, назву тесту, дату, % результат, підпис/печатка
- Унікальний QR-код для верифікації
- Бібліотека: `@react-pdf/renderer`

---

## Фаза 4 — Комунікація та нотифікації

### 4.1 Telegram-бот

- Бот надсилає посилання на тест прямо в чат
- Нотифікація адміну при новому результаті: `"Іван Петренко здав тест: 85% ✅"`
- Команда `/results` у боті — остання статистика
- Бібліотека: `node-telegram-bot-api`

**Новий сервіс:** `server/services/telegramBot.js`

---

### 4.2 Email-нотифікації

- Відправка посилання на тест по email
- Лист студенту з результатом і сертифікатом (якщо є)
- Бібліотека: `nodemailer` + SMTP або SendGrid

---

### 4.3 Дедлайни та нагадування

- Поле `deadline` у `DeskTest` та `Quiz`
- Якщо студент не пройшов до дедлайну — повторне нагадування в Telegram/email
- Статус тесту: `active` / `expired` / `completed`

---

## Фаза 5 — Мультикористувацькість

### 5.1 Ролі та права доступу

| Роль | Права |
|------|-------|
| `superadmin` | Все |
| `admin` | Свої шаблони, тести, перегляд своїх результатів |
| `trainer` | Лише створення тестів і перегляд результатів |
| `viewer` | Лише перегляд результатів |

- Модель `User` (`username`, `passwordHash`, `role`)
- Сторінка управління користувачами (лише superadmin)
- Кожен тест має `ownerId` — адмін бачить лише свої

---

### 5.2 Організації / Тенанти (multi-tenant)

Якщо систему використовують кілька закладів:

- Модель `Organization` (`name`, `slug`, `logo`)
- Кожен запис (шаблон, тест, результат) прив'язаний до `organizationId`
- Ізольовані дані між організаціями
- Окремий піддомен або `slug`-префікс: `/org/:slug/test/:hash`

---

## Фаза 6 — Технічний борг та якість

### 6.1 Тестування

- Unit-тести для серверного оцінювання (`tests.js`)
- Integration-тести для API маршрутів (`supertest`)
- E2E-тести для потоку студента (`Playwright` або `Cypress`)

**Структура:**
```
server/
└── __tests__/
    ├── scoring.test.js
    ├── templates.test.js
    └── auth.test.js
```

---

### 6.2 Завантаження зображень

- Адмін завантажує фото страв для предметів столу
- Зображення для питань Quiz
- Зберігання: локальна папка `uploads/` або AWS S3 / Cloudinary
- Бібліотека: `multer`

---

### 6.3 Кешування та продуктивність

- Redis для кешування часто запитуваних шаблонів
- Пагінація результатів (зараз повертається весь масив)
- Індекси MongoDB на `hash`, `completedAt`, `templateName`

---

### 6.4 Безпека

- Rate limiting на `/api/auth/login` (`express-rate-limit`)
- Helmet.js для HTTP-заголовків
- Sanitization вхідних даних (`express-validator` або `joi`)
- HTTPS через nginx reverse proxy (для production)
- `.env` в `.gitignore` + `env.example` для документації

---

## Орієнтовні пріоритети

```
Зараз → Фаза 1 (Групи + Статистика + Експорт)
        ↓
        Фаза 2 (Quiz Builder — найзапитуваніший тип тесту)
        ↓
        Фаза 4 (Telegram-бот — практична цінність)
        ↓
        Фаза 3 (Сертифікати + Training Paths)
        ↓
        Фаза 5 (якщо система росте до кількох адмінів)
        ↓
        Фаза 6 (постійно, паралельно)
```

---

## Стек розширень

| Завдання | Бібліотека |
|----------|-----------|
| Графіки | `recharts` |
| Drag & Drop | `@dnd-kit/core` |
| PDF | `@react-pdf/renderer` або `pdfmake` |
| Excel/CSV | `xlsx` або `papaparse` |
| Email | `nodemailer` |
| Telegram | `node-telegram-bot-api` |
| Rate limiting | `express-rate-limit` |
| Security headers | `helmet` |
| File upload | `multer` |
| Tests | `jest` + `supertest` + `Playwright` |
